(function(f){function i(){return!1}function e(a,b){this.element=a;this.options=b;this.previewWidth="right"===b.preview?50:0;this._create()}e.prototype._create=function(){this.canvas=this.element.is("canvas")?this.element.get(0):f("<canvas />").attr({width:this.element.width(),height:this.element.height()}).appendTo(this.element).get(0);this.context=this.canvas.getContext("2d");this._init()};e.prototype._init=function(){var a=this._width(),b=this._height(),c=this.element.width(),d,e,g,h=this.context.createImageData(c,
b);for(d=0;d<a;d++)for(e=0;e<b;e++)g=4*(d+e*c),rgb=this._rgb(d,e,a,b),h.data[g]=rgb[0],h.data[g+1]=rgb[1],h.data[g+2]=rgb[2],h.data[g+3]=255;this.context.putImageData(h,0,0);this.element.bind({"mousedown mousemove mouseup":f.proxy(this,"_change"),colorstripchange:f.proxy(this,"_preview")});this.canvas.addEventListener&&(this.canvas.addEventListener("touchstart",f.proxy(this,"_touchevent"),!1),this.canvas.addEventListener("touchmove",f.proxy(this,"_touchevent"),!1),this.canvas.addEventListener("touchend",
f.proxy(this,"_touchevent"),!1),this.canvas.addEventListener("touchcancel",f.proxy(this,"_touchevent"),!1));this.canvas.onselectstart=i;this._preview(0,"#000")};e.prototype._preview=function(a,b){this.context.rect(this._width()+5,0,this.previewWidth-5,this._height());this.context.fillStyle=b;this.context.fill()};e.prototype._change=function(a){var b;if("mousedown"===a.type)this._mousedown=!0;else if("mouseup"===a.type)this._mousedown=!1;this._mousedown&&(b=a.pageX-this.element.offset().left,a=a.pageY-
this.element.offset().top,b=this._rgbToHex(this._rgb(b,a)),this.element.trigger("colorstripchange",b),this.options.change&&this.options.change.call(this.element,b))};e.prototype._touchevent=function(a){var b=a.changedTouches[0],c={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[a.type];if(c){var d=document.createEvent("MouseEvent");d.initMouseEvent(c,!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null);b.target.dispatchEvent(d);a.preventDefault()}};e.prototype._rgbToHex=
function(a){for(var b="#",c,d=0,e=a.length;d<e;d++)c=a[d],b+="0123456789ABCDEF".charAt((c-c%16)/16)+"0123456789ABCDEF".charAt(c%16);return b};e.prototype._rgb=function(a,b,c,d){c=c||this._width();d=d||this._height();b=[300*(a/c),1,1-b/d];a=b[0];c=b[1];b=b[2];c*=1-Math.abs(2*b-1);d=a/60;a=c*(1-Math.abs(d%2-1));b-=c/2;a=1>d?[c,a,0]:2>d?[a,c,0]:3>d?[0,c,a]:4>d?[0,a,c]:5>d?[a,0,c]:6>d?[c,0,a]:[0,0,0];a[0]+=b;a[1]+=b;a[2]+=b;a[0]*=255;a[1]*=255;a[2]*=255;return a};e.prototype._width=function(){return this.element.width()-
this.previewWidth};e.prototype._height=function(){return this.element.height()};f.fn.extend({colorstrip:function(a){var b=f(this),a=f.isFunction(a)?{change:a}:a,a=new e(b,a);b.data("colorstrip",a);return this}})})(jQuery);
