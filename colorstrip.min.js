(function(f){function h(){return false}function e(a){this.element=a;this._create()}e.prototype._create=function(){this.canvas=this.element.is("canvas")?this.element.get(0):f("<canvas />").attr({width:this._width(),height:this._height()}).appendTo(this.element).get(0);this.context=this.canvas.getContext("2d");this._init()};e.prototype._init=function(){var a=this._width(),c=this._height(),b,d,g,e=this.context.createImageData(a,c);for(b=0;b<a;b++)for(d=0;d<c;d++)g=(b+d*a)*4,rgb=this._rgb(b,d,a,c),e.data[g]=
rgb[0],e.data[g+1]=rgb[1],e.data[g+2]=rgb[2],e.data[g+3]=255;this.context.putImageData(e,0,0);this.element.bind("mousedown mousemove mouseup",f.proxy(this,"_change"));this.canvas.onselectstart=h};e.prototype._change=function(a){if(a.type==="mousedown")this._mousedown=true;else if(a.type==="mouseup")this._mousedown=false;if(this._mousedown){var c=a.pageX-this.element.offset().left,a=a.pageY-this.element.offset().top;this.element.trigger("colorstripchange",this._rgbToHex(this._rgb(c,a)))}};e.prototype._rgbToHex=
function(a){for(var c="#",b,d=0,e=a.length;d<e;d++)b=a[d],c+="0123456789ABCDEF".charAt((b-b%16)/16)+"0123456789ABCDEF".charAt(b%16);return c};e.prototype._rgb=function(a,c,b,d){b=b||this._width();d=d||this._height();c=[a/b*300,1,1-c/d];a=c[0];b=c[1];c=c[2];b*=1-Math.abs(2*c-1);d=a/60;a=b*(1-Math.abs(d%2-1));c-=b/2;a=d<1?[b,a,0]:d<2?[a,b,0]:d<3?[0,b,a]:d<4?[0,a,b]:d<5?[a,0,b]:d<6?[b,0,a]:[0,0,0];a[0]+=c;a[1]+=c;a[2]+=c;a[0]*=255;a[1]*=255;a[2]*=255;return a};e.prototype._width=function(){return this.element.width()};
e.prototype._height=function(){return this.element.height()};f.fn.extend({colorstrip:function(a){var c=f(this),b=new e(c);c.data("colorstrip",b);f.isFunction(a)&&c.bind("colorstripchange",function(b,c){a.call(this,c)});return this}})})(jQuery);
